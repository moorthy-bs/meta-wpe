From 43ba11c0b3d27ca27816f98d434c5defc0fc1857 Mon Sep 17 00:00:00 2001
From: Moorthy Baskar <moorthy.baskaravenkatraman-sambamoorthy@linaro.org>
Date: Thu, 6 Feb 2020 15:35:32 +0100
Subject: [PATCH] [python tools]: python 2to3 conversion

Signed-off-by: Moorthy Baskar <moorthy.baskaravenkatraman-sambamoorthy@linaro.org>
---
 Tools/JsonGenerator/JsonGenerator.py      | 102 +++++++++++++++---------------
 Tools/ProxyStubGenerator/CppParser.py     |  20 +++---
 Tools/ProxyStubGenerator/Interface.py     |   5 +-
 Tools/ProxyStubGenerator/StubGenerator.py |  64 +++++++++----------
 Tools/ProxyStubGenerator/__init__.py      |   4 +-
 5 files changed, 97 insertions(+), 98 deletions(-)

diff --git a/Tools/JsonGenerator/JsonGenerator.py b/Tools/JsonGenerator/JsonGenerator.py
index 0ae49b1..127faf8 100755
--- a/Tools/JsonGenerator/JsonGenerator.py
+++ b/Tools/JsonGenerator/JsonGenerator.py
@@ -1,6 +1,6 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 
-import argparse, sys, re, os, json, posixpath, urllib, glob
+import argparse, sys, re, os, json, posixpath, urllib.request, urllib.parse, urllib.error, glob
 from collections import OrderedDict
 
 sys.path.append(os.path.dirname(os.path.abspath(__file__)) + os.sep + "..")
@@ -16,7 +16,7 @@ class Trace:
     def __init__(self):
         self.errors = 0
     def __Print(self, text):
-        print text
+        print(text)
     def Header(self, text):
         self.__Print(text)
     def Warn(self, text):
@@ -33,7 +33,7 @@ try:
     import jsonref
 except:
     trace.Error("Install jsonref first")
-    print "e.g. try 'pip install jsonref'"
+    print("e.g. try 'pip install jsonref'")
     sys.exit(1)
 
 INDENT_SIZE = 4
@@ -216,7 +216,7 @@ class JsonEnum(JsonType):
                 classname = MakeEnum(self.CppName())
             return classname
     def CppEnumerators(self):
-        return map(lambda x: ("E" if x[0].isdigit() else "") + x.upper(), self.enumerators)
+        return [("E" if x[0].isdigit() else "") + x.upper() for x in self.enumerators]
     def CppEnumeratorValues(self):
         return self.values
     def IsDuplicate(self):
@@ -251,7 +251,7 @@ class JsonObject(JsonType):
                 self.origRef = obj
                 if obj.parent != parent:
                     obj.AddRef(self)
-            for prop_name, prop in schema["properties"].iteritems():
+            for prop_name, prop in schema["properties"].items():
                 newObject = JsonItem(prop_name, self, prop, included=included)
                 self.properties.append(newObject)
                 # Handle aggregate objects
@@ -317,7 +317,7 @@ class JsonObject(JsonType):
         return self.properties
     def NeedsCopyCtor(self):
         # Check if a copy constructory is needed by scanning all duplicate classes
-        return ALWAYS_COPYCTOR or self.parent.NeedsCopyCtor() or filter(lambda obj: obj.parent.NeedsCopyCtor() if self != obj else False, self.refs)
+        return ALWAYS_COPYCTOR or self.parent.NeedsCopyCtor() or [obj for obj in self.refs if (obj.parent.NeedsCopyCtor() if self != obj else False)]
     def AddRef(self, obj):
         self.refs.append(obj)
     def RefCount(self):
@@ -430,27 +430,27 @@ class JsonRpcSchema(JsonType):
         if "interface" in schema:
             schema = schema["interface"]
         if "include" in schema:
-            for name, s in schema["include"].iteritems():
+            for name, s in schema["include"].items():
                 include = s["info"]["class"]
                 self.includes.append(include)
                 if "methods" in s:
-                    for name, method in s["methods"].iteritems():
+                    for name, method in s["methods"].items():
                         newMethod = JsonMethod(name, self, method, include)
                         self.methods.append(newMethod)
                 if "properties" in s:
-                    for name, method in s["properties"].iteritems():
+                    for name, method in s["properties"].items():
                         newMethod = JsonProperty(name, self, method, include)
                         self.methods.append(newMethod)
                 if "events" in s:
-                    for name, method in s["events"].iteritems():
+                    for name, method in s["events"].items():
                         newMethod = JsonNotification(name, self, method, include)
                         self.methods.append(newMethod)
 
-        method_list = map(lambda x: x.name, self.methods)
+        method_list = [x.name for x in self.methods]
 
         def __AddMethods(section, schema, ctor):
             if section in schema:
-                for name, method in schema[section].iteritems():
+                for name, method in schema[section].items():
                     if name in method_list:
                         del self.methods[method_list.index(name)]
                         method_list.remove(name)
@@ -531,7 +531,7 @@ def LoadSchema(file, include_path, cpp_include_path):
                         ref_tok[0] = os.path.join(path, ref_tok[0])
                 if not os.path.isfile(ref_tok[0]):
                     raise RuntimeError("$ref file '%s' not found" % ref_tok[0])
-                ref_file = '"file:%s#%s"' % (urllib.pathname2url(ref_tok[0]), ref_tok[1])
+                ref_file = '"file:%s#%s"' % (urllib.request.pathname2url(ref_tok[0]), ref_tok[1])
                 tokens[c + 2] = ref_file
             elif t == '"$cppref"' and tokens[c + 1] == ":" and tokens[c + 2][:2] != '"#':
                 ref_file = tokens[c + 2].strip('"')
@@ -655,7 +655,7 @@ def LoadInterface(file):
                 params["required"] = required
                 if prop:
                     if len(properties) == 1:
-                        return properties.values()[0]
+                        return list(properties.values())[0]
                     elif len(properties) > 1:
                         params["required"] = required
                         return params
@@ -679,7 +679,7 @@ def LoadInterface(file):
                         required.append(var_name)
                 params["properties"] = properties
                 if len(properties) == 1:
-                    return properties.values()[0]
+                    return list(properties.values())[0]
                 elif len(properties) > 1:
                     params["required"] = required
                     return params
@@ -771,9 +771,9 @@ def LoadInterface(file):
             schema["events"] = events
 
         if DUMP_JSON:
-            print "\n// JSON interface for %s -----------" % face.obj.name
-            print json.dumps(schema, indent=2)
-            print "// ----------------\n"
+            print("\n// JSON interface for %s -----------" % face.obj.name)
+            print(json.dumps(schema, indent=2))
+            print("// ----------------\n")
         return schema
 
     schemas = []
@@ -805,10 +805,10 @@ def SortByDependency(objects):
     sortedObjects = []
     # This will order objects by their relations
     for obj in sorted(objects, key=lambda x: x.CppClass(), reverse=False):
-        found = filter(lambda sortedObj: obj.CppClass() in map(lambda x: x.CppClass(), sortedObj.Objects()), sortedObjects)
+        found = [sortedObj for sortedObj in sortedObjects if obj.CppClass() in [x.CppClass() for x in sortedObj.Objects()]]
         if found:
-            index = min(map(lambda x: sortedObjects.index(x), found))
-            movelist = filter(lambda x: x.CppClass() in map(lambda x: x.CppClass(), sortedObjects), obj.Objects())
+            index = min([sortedObjects.index(x) for x in found])
+            movelist = [x for x in obj.Objects() if x.CppClass() in [x.CppClass() for x in sortedObjects]]
             sortedObjects.insert(index, obj)
             for m in movelist:
                 if m in sortedObjects:
@@ -831,7 +831,7 @@ class ObjectTracker:
     def Add(self, newObj):
         def __Compare(lhs, rhs):
             # NOTE: Two objects are considered identical if they have the same property names and types only!
-            for name, prop in lhs.iteritems():
+            for name, prop in lhs.items():
                 if name not in rhs:
                     return False
                 elif rhs[name]["type"] != prop["type"]:
@@ -842,7 +842,7 @@ class ObjectTracker:
                             return False
                     else:
                         return False
-            for name, prop in rhs.iteritems():
+            for name, prop in rhs.items():
                 if name not in lhs:
                     return False
                 elif lhs[name]["type"] != prop["type"]:
@@ -869,7 +869,7 @@ class ObjectTracker:
     def Reset(self):
         self.objects = []
     def CommonObjects(self):
-        return SortByDependency(filter(lambda obj: obj.RefCount() > 1, self.Objects()))
+        return SortByDependency([obj for obj in self.Objects() if obj.RefCount() > 1])
 
 class EnumTracker(ObjectTracker):
     def __IsTopmost(self, obj):
@@ -900,7 +900,7 @@ class EnumTracker(ObjectTracker):
                     return obj
             return None
     def CommonObjects(self):
-        return SortByDependency(filter(lambda obj: obj.RefCount() > 1 or self.__IsTopmost(obj), self.Objects()))
+        return SortByDependency([obj for obj in self.Objects() if obj.RefCount() > 1 or self.__IsTopmost(obj)])
 
 #
 # THE EMITTER
@@ -984,7 +984,7 @@ def EmitEvent(emit, root, event, static = False):
         emit.Line("// Event: %s" % event.JsonName())
     params = event.Properties()[0].CppType()
     par = "const string& id, " if event.HasSendif() else ""
-    par = par + ", ".join(map(lambda x: "const " + GetNamespace(root, x, False) + x.CppStdClass() + "& " + x.JsonName(), event.Properties()[0].Properties()))
+    par = par + ", ".join(["const " + GetNamespace(root, x, False) + x.CppStdClass() + "& " + x.JsonName() for x in event.Properties()[0].Properties()])
     if not static:
         line = "void %s::%s(%s)" % (root.JsonName(), event.MethodName(), par)
     else:
@@ -1212,7 +1212,7 @@ def EmitHelperCode(root, emit, header_file):
                 has_statuslistener = True
                 break
 
-        print "Emitting registration code..."
+        print("Emitting registration code...")
         emit.Line("/*")
         emit.Indent()
         emit.Line("// Copy the code below to %s class definition" % root.JsonName())
@@ -1252,7 +1252,7 @@ def EmitHelperCode(root, emit, header_file):
                 params = __NsName(method.Properties()[0])
                 par = ""
                 if params != "void":
-                    par = ", ".join(map(lambda x: "const " + GetNamespace(root, x) + x.CppStdClass() + "& " + x.JsonName(), method.Properties()[0].Properties()))
+                    par = ", ".join(["const " + GetNamespace(root, x) + x.CppStdClass() + "& " + x.JsonName() for x in method.Properties()[0].Properties()])
                 line = ('void %s(%s%s);' % (method.MethodName(), "const string& id, " if method.HasSendif() else "", par))
                 if method.included_from:
                     line += " // %s" % method.included_from
@@ -1324,13 +1324,13 @@ def EmitHelperCode(root, emit, header_file):
         emit.Line()
 
         # Method/property/event stubs
-        print "Emitting stubs..."
+        print("Emitting stubs...")
         emit.Line("// API implementation")
         emit.Line("//")
         emit.Line()
         for method in root.Properties():
             if not isinstance(method, JsonNotification) and not isinstance(method, JsonProperty):
-                print "Emitting method '%s'" % method.JsonName()
+                print("Emitting method '%s'" % method.JsonName())
                 params = method.Properties()[0].CppType()
                 if method.Summary():
                     emit.Line("// Method: %s - %s" % (method.JsonName(), method.Summary().split(".",1)[0]))
@@ -1400,7 +1400,7 @@ def EmitHelperCode(root, emit, header_file):
                     emit.Unindent()
                     emit.Line("}")
                     emit.Line()
-                print "Emitting property '%s'%s" % (method.JsonName(), " (write-only)" if method.writeonly else " (read-only)" if method.readonly else "")
+                print("Emitting property '%s'%s" % (method.JsonName(), " (write-only)" if method.writeonly else " (read-only)" if method.readonly else ""))
                 if not method.writeonly:
                     EmitPropertyFc(method, method.GetMethodName(), True)
                 if not method.readonly:
@@ -1408,7 +1408,7 @@ def EmitHelperCode(root, emit, header_file):
 
         for method in root.Properties():
             if isinstance(method, JsonNotification):
-                print "Emitting notification '%s'" % method.JsonName()
+                print("Emitting notification '%s'" % method.JsonName())
                 EmitEvent(emit, root, method)
 
         emit.Unindent()
@@ -1430,7 +1430,7 @@ def EmitObjects(root, emit, emitCommon = False):
     def EmitEnum(enum):
         global emittedItems
         emittedItems += 1
-        print "Emitting enum %s" % enum.CppClass()
+        print("Emitting enum %s" % enum.CppClass())
         root = enum.parent.parent
         while root.parent:
             root = root.parent
@@ -1477,7 +1477,7 @@ def EmitObjects(root, emit, emitCommon = False):
         if jsonObj.IsDuplicate() or (not allowDup and jsonObj.RefCount() > 1):
             return
         if not isinstance(jsonObj, (JsonRpcSchema, JsonMethod)):
-            print "Emitting class '%s' (source: '%s')" % (jsonObj.CppClass(), jsonObj.OrigName())
+            print("Emitting class '%s' (source: '%s')" % (jsonObj.CppClass(), jsonObj.OrigName()))
             emit.Line("class %s : public %s {" % (jsonObj.CppClass(), TypePrefix("Container")))
             emit.Line("public:")
             if jsonObj.Enums():
@@ -1560,7 +1560,7 @@ def EmitObjects(root, emit, emitCommon = False):
     emit.Indent()
     emit.Line()
     if emitCommon and enumTracker.CommonObjects():
-        print "Emitting common enums..."
+        print("Emitting common enums...")
         emit.Line("// Common enums")
         emit.Line("//")
         emit.Line()
@@ -1568,7 +1568,7 @@ def EmitObjects(root, emit, emitCommon = False):
             if not obj.IsDuplicate() and not obj.included_from:
                 EmitEnum(obj)
     if emitCommon and objTracker.CommonObjects():
-        print "Emitting common classes..."
+        print("Emitting common classes...")
         emit.Line("// Common classes")
         emit.Line("//")
         emit.Line()
@@ -1576,7 +1576,7 @@ def EmitObjects(root, emit, emitCommon = False):
             if not obj.included_from:
                 EmitClass(obj, True)
     if root.Objects():
-        print "Emitting params/result classes..."
+        print("Emitting params/result classes...")
         emit.Line("// Method params/result classes")
         emit.Line("//")
         emit.Line()
@@ -1739,7 +1739,7 @@ def CreateDocument(schema, path):
                 if obj["type"] == "object":
                     if "required" not in obj and name and len(obj["properties"]) > 1:
                         trace.Warn('No "required" field for object "%s"' % name)
-                    for pname, props in obj["properties"].iteritems():
+                    for pname, props in obj["properties"].items():
                         __TableObj(pname, props, parentName+"/"+name, obj, prefix, False)
                 elif obj["type"] == "array":
                     __TableObj("", obj["items"], parentName+"/"+name, obj, (prefix + "[#]") if name else "", optional)
@@ -1757,7 +1757,7 @@ def CreateDocument(schema, path):
 
         def PlainTable(obj, columns, ref="ref"):
             MdTableHeader(columns)
-            for prop,val in sorted(obj.iteritems()):
+            for prop,val in sorted(obj.items()):
                 MdRow(["<a name=\"%s.%s\">%s</a>" % (ref, (prop.split("]",1)[0][1:]) if "]" in prop else prop, prop), val])
             MdBr()
 
@@ -1804,7 +1804,7 @@ def CreateDocument(schema, path):
                 MdHeader("Description", 3)
                 MdParagraph(props["description"])
             if "events" in props:
-                MdParagraph("Also see: " + (", ".join(map(lambda x: link("event." + x), props["events"]))))
+                MdParagraph("Also see: " + (", ".join([link("event." + x) for x in props["events"]])))
             if is_property:
                 MdHeader("Value", 3)
                 if not "description" in props["params"]:
@@ -1904,7 +1904,7 @@ def CreateDocument(schema, path):
         if "events" in interface:
             event_count = len(interface["events"])
         if "include" in interface:
-            for name, iface in interface["include"].iteritems():
+            for name, iface in interface["include"].items():
                 if "methods" in iface:
                     method_count += len(iface["methods"])
                 if "properties" in iface:
@@ -1955,7 +1955,7 @@ def CreateDocument(schema, path):
         MdBr()
 
         def mergedict(d1, d2, prop):
-            return dict((d1[prop] if prop in d1 else dict()).items() + (d2[prop] if prop in d2 else dict()).items())
+            return dict(list((d1[prop] if prop in d1 else dict()).items()) + list((d2[prop] if prop in d2 else dict()).items()))
 
         MdHeader("Introduction")
         MdHeader("Scope", 2)
@@ -2020,7 +2020,7 @@ def CreateDocument(schema, path):
 
             required = []
             if "configuration" in schema:
-                commonConfig2 = OrderedDict(commonConfig.items() + schema["configuration"]["properties"].items())
+                commonConfig2 = OrderedDict(list(commonConfig.items()) + list(schema["configuration"]["properties"].items()))
                 required = schema["configuration"]["required"] if "required" in schema["configuration"] else []
             else:
                 commonConfig2 = commonConfig
@@ -2039,7 +2039,7 @@ def CreateDocument(schema, path):
             def InterfaceDump(interface, section, header):
                 head = False
                 if section in interface:
-                    for method, contents in interface[section].iteritems():
+                    for method, contents in interface[section].items():
                         if contents and method not in skip_list:
                             if not head:
                                 MdParagraph("%s interface %s:" % (interface["info"]["class"], section))
@@ -2070,7 +2070,7 @@ def CreateDocument(schema, path):
             MdParagraph("The following %s are provided by the %s plugin:" % (section, plugin_class))
             InterfaceDump(interface, section, header)
             if "include" in interface:
-                for name, s in interface["include"].iteritems():
+                for name, s in interface["include"].items():
                     if s:
                         if section in s:
                             MdBr()
@@ -2083,17 +2083,17 @@ def CreateDocument(schema, path):
             skip_list = []
 
             if section in interface:
-                for method, props in interface[section].iteritems():
+                for method, props in interface[section].items():
                     if props:
                         MethodDump(method, props, plugin_class, event, prop)
                     skip_list.append(method)
 
             if "include" in interface:
-                for name, s in interface["include"].iteritems():
+                for name, s in interface["include"].items():
                     if s:
                         cl = s["info"]["class"]
                         if section in s:
-                            for method, props in s[section].iteritems():
+                            for method, props in s[section].items():
                                 if props and method not in skip_list:
                                     MethodDump(method, props, plugin_class, event, prop, cl)
 
@@ -2159,7 +2159,7 @@ if __name__ == "__main__":
     generateStubs = args.stubs
 
     if args.version:
-        print "Version: %s" % VERSION
+        print("Version: %s" % VERSION)
         sys.exit(1)
     elif not args.path or (not generateCode and not generateRpc and not generateStubs and not generateDocs):
         argparser.print_help()
@@ -2198,6 +2198,6 @@ if __name__ == "__main__":
                 trace.Error(str(err))
             except ValueError as err:
                 trace.Error(str(err))
-        print "\nJsonGenerator: All done. %s error%s." % (trace.errors if trace.errors else "No", "" if trace.errors == 1 else "s")
+        print("\nJsonGenerator: All done. %s error%s." % (trace.errors if trace.errors else "No", "" if trace.errors == 1 else "s"))
         if trace.errors:
             sys.exit(1)
diff --git a/Tools/ProxyStubGenerator/CppParser.py b/Tools/ProxyStubGenerator/CppParser.py
index c3d3534..0e99cd2 100755
--- a/Tools/ProxyStubGenerator/CppParser.py
+++ b/Tools/ProxyStubGenerator/CppParser.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 
 #
 # C++ header parser
@@ -438,7 +438,7 @@ class Variable(Type, Identifier):
     def __repr__(self):
         return str(self)
 
-class Parameter(Type, Variable):
+class Parameter(Variable):
     def __init__(self, parent_block, string, value = [], valid_specifiers = []):
         Variable.__init__(self, parent_block, string, value, valid_specifiers)
         if self.name in parent_block.param:
@@ -478,7 +478,7 @@ class Enumerator(Type, Identifier):
         Identifier.__init__(self, parent_enum, self.name)
         self.parent = parent_block
         self.value = parent_block.GetValue() if value == None else Evaluate(value)
-        if isinstance(self.value, (int, long)):
+        if isinstance(self.value, int):
             self.parent.SetValue(self.value)
         self.parent.items.append(self)
     def __str__(self):
@@ -1070,22 +1070,22 @@ def DumpTree(tree, ind = 0):
     indent = ind*" "
 
     if isinstance(tree, (Namespace, Class)):
-        print indent + str(tree)
+        print(indent + str(tree))
 
         for td in tree.typedefs:
-            print indent + 2*" " + str(td)
+            print(indent + 2*" " + str(td))
 
         for e in tree.enums:
-            print indent + 2*" " + str(e)
+            print(indent + 2*" " + str(e))
             for item in e.items:
-                print indent + 4*" " + str(item)
+                print(indent + 4*" " + str(item))
 
     for v in tree.vars:
-        print indent + 2*" " + str(v)
+        print(indent + 2*" " + str(v))
 
     if isinstance(tree, (Namespace, Class)):
         for m in tree.methods:
-           print indent + 2*" " + str(m)
+           print(indent + 2*" " + str(m))
 
     if isinstance(tree, (Namespace, Class)):
         for c in tree.classes:
@@ -1103,4 +1103,4 @@ if __name__ == "__main__":
     if isinstance(tree, Namespace):
          DumpTree(tree)
     else:
-        print tree
+        print(tree)
diff --git a/Tools/ProxyStubGenerator/Interface.py b/Tools/ProxyStubGenerator/Interface.py
index 0cae7e4..b04d521 100644
--- a/Tools/ProxyStubGenerator/Interface.py
+++ b/Tools/ProxyStubGenerator/Interface.py
@@ -1,7 +1,6 @@
+#!/usr/bin/env python3
 
-import CppParser
-
-#!/usr/bin/env python
+from . import CppParser
 
 CLASS_IUNKNOWN = "::WPEFramework::Core::IUnknown"
 
diff --git a/Tools/ProxyStubGenerator/StubGenerator.py b/Tools/ProxyStubGenerator/StubGenerator.py
index 1ee03c3..b972dac 100755
--- a/Tools/ProxyStubGenerator/StubGenerator.py
+++ b/Tools/ProxyStubGenerator/StubGenerator.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 
 #
 # WPE Framework proxy stub code generator
@@ -43,21 +43,21 @@ class Log:
     def Info(self, text, file = ""):
         if BE_VERBOSE:
             self.infos.append("%s: INFO: %s%s%s" % (NAME, file, ": " if file else "", text))
-            print self.infos[-1]
+            print(self.infos[-1])
     def Warn(self, text, file = ""):
         if SHOW_WARNINGS:
             self.warnings.append("%s: WARNING: %s%s%s" % (NAME, file, ": " if file else "", text))
-            print self.warnings[-1]
+            print(self.warnings[-1])
     def Error(self, text, file = ""):
             self.errors.append("%s: ERROR: %s%s%s" % (NAME, file, ": " if file else "", text))
-            print >> sys.stderr, self.errors[-1]
+            print(self.errors[-1], file=sys.stderr)
     def Print(self, text, file = ""):
-        print("%s: %s%s%s" % (NAME, file, ": " if file else "", text))
+        print(("%s: %s%s%s" % (NAME, file, ": " if file else "", text)))
     def Dump(self):
             if self.errors or self.warnings or self.infos:
-                print ""
+                print("")
                 for item in self.errors + self.warnings + self.infos:
-                    print item
+                    print(item)
 
 
 log = Log()
@@ -146,7 +146,7 @@ def GenerateStubs(output_file, source_file, defaults = "", scan_only = False):
 
     for iface in interfaces:
         if iface.id < MIN_INTERFACE_ID:
-            log.Warn("invalid interface ID %s (%s) of %s - shall be at least 0x40" % (hex(iface.id) if isinstance(iface.id, (long, int)) else "?", str(iface.id), iface.obj.full_name), source_file)
+            log.Warn("invalid interface ID %s (%s) of %s - shall be at least 0x40" % (hex(iface.id) if isinstance(iface.id, int) else "?", str(iface.id), iface.obj.full_name), source_file)
 
     if scan_only:
         return interfaces
@@ -1099,7 +1099,7 @@ def GenerateStubs(output_file, source_file, defaults = "", scan_only = False):
         if announce_list:
             emit.Line()
 
-        for key, val in announce_list.iteritems():
+        for key, val in announce_list.items():
             emit.Line("typedef ProxyStub::UnknownStubType<%s, %s> %s;" % (key, val[1], val[2]))
 
         emit.Line()
@@ -1111,7 +1111,7 @@ def GenerateStubs(output_file, source_file, defaults = "", scan_only = False):
         emit.Line("{")
         emit.IndentInc()
 
-        for key, val in announce_list.iteritems():
+        for key, val in announce_list.items():
             emit.Line("RPC::Administrator::Instance().Announce<%s, %s, %s>();" % (key, val[0], val[2]))
 
         emit.IndentDec()
@@ -1161,24 +1161,24 @@ if __name__ == "__main__":
         INTERFACE_NAMESPACE = "::" + INTERFACE_NAMESPACE
 
     if args.help_tags:
-        print "The following special tags are supported:"
-        print "   @stubgen:skip     - skip parsing of the rest of the file"
-        print "   @stubgen:omit     - omit generating code for the next item (class or method)"
-        print "   @stubgen:stub     - generate empty stub for the next item (class or method)"
-        print "For non-const pointer and reference method/function parameters:"
-        print "   @in               - denotes an input parameter"
-        print "   @out              - denotes an output parameter"
-        print "   @inout            - denotes an input/output parameter (equivalent of @in @out)"
-        print "   @length:<expr>    - specifies a buffer length value (a constant, a parameter name or a math expression)"
-        print "   @maxlength:<expr> - specifies a maximum buffer length value (a constant, a parameter name or a math expression),"
-        print "                       if not specified @length is used as maximum length, use round parenthesis for expressions,"
-        print "                       e.g.: @length:bufferSize @length:(width*height*4)"
-        print ""
-        print "The tags shall be placed inside comments."
+        print("The following special tags are supported:")
+        print("   @stubgen:skip     - skip parsing of the rest of the file")
+        print("   @stubgen:omit     - omit generating code for the next item (class or method)")
+        print("   @stubgen:stub     - generate empty stub for the next item (class or method)")
+        print("For non-const pointer and reference method/function parameters:")
+        print("   @in               - denotes an input parameter")
+        print("   @out              - denotes an output parameter")
+        print("   @inout            - denotes an input/output parameter (equivalent of @in @out)")
+        print("   @length:<expr>    - specifies a buffer length value (a constant, a parameter name or a math expression)")
+        print("   @maxlength:<expr> - specifies a maximum buffer length value (a constant, a parameter name or a math expression),")
+        print("                       if not specified @length is used as maximum length, use round parenthesis for expressions,")
+        print("                       e.g.: @length:bufferSize @length:(width*height*4)")
+        print("")
+        print("The tags shall be placed inside comments.")
         sys.exit()
 
     if args.show_version:
-        print "Version: " + VERSION
+        print("Version: " + VERSION)
         sys.exit()
 
     if not args.path:
@@ -1208,7 +1208,7 @@ if __name__ == "__main__":
                     # dump interfaces if only scanning
                     for f in sorted(output, key=lambda x: x.id):
                         if scan_only:
-                            print f.id, f.obj.full_name
+                            print(f.id, f.obj.full_name)
 
                 except SkipFileError as err:
                     log.Print("skipped file '%s'" % err)
@@ -1223,23 +1223,23 @@ if __name__ == "__main__":
                     log.Error(err)
 
             if scan_only:
-                print "\nInterface dump:"
+                print("\nInterface dump:")
 
             sorted_faces = sorted(faces, key=lambda x: x.id)
             for i, f in enumerate(sorted_faces):
-                if isinstance(f.id, (long, int)):
+                if isinstance(f.id, int):
                     if scan_only:
                         if i and sorted_faces[i - 1].id < f.id - 1:
-                            print "..."
-                        print "%s (%s) - '%s'" % (hex(f.id) if isinstance(f.id, (int, long)) else "?", str(f.id), f.obj.full_name)
+                            print("...")
+                        print("%s (%s) - '%s'" % (hex(f.id) if isinstance(f.id, int) else "?", str(f.id), f.obj.full_name))
                     if i and sorted_faces[i - 1].id == f.id:
-                        log.Warn("duplicate interface ID %s (%s) of %s" % (hex(f.id) if isinstance(f.id, (int, long)) else "?", str(f.id), f.obj.full_name), f.file)
+                        log.Warn("duplicate interface ID %s (%s) of %s" % (hex(f.id) if isinstance(f.id, int) else "?", str(f.id), f.obj.full_name), f.file)
                 else:
                     log.Info("can't evaluate interface ID \"%s\" of %s" % (str(f.id), f.obj.full_name), f.file)
 
 
             if len(interface_files) > 1 and BE_VERBOSE:
-                print ""
+                print("")
 
             log.Print(("all done; %i file%s processed" % (len(interface_files) - len(skipped), "s" if len(interface_files) - len(skipped) > 1 else "")) + \
                 ((" (%i file%s skipped)" % (len(skipped), "s" if len(skipped) > 1 else "")) if skipped else "") + \
diff --git a/Tools/ProxyStubGenerator/__init__.py b/Tools/ProxyStubGenerator/__init__.py
index 2ea6555..3d78419 100644
--- a/Tools/ProxyStubGenerator/__init__.py
+++ b/Tools/ProxyStubGenerator/__init__.py
@@ -1,2 +1,2 @@
-import CppParser
-import Interface
+from . import CppParser
+from . import Interface
-- 
2.7.4

